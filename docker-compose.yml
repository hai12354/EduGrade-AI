services:
  # --- BACKEND SERVICES ---
  auth-service:
    build:
      context: ./BE
      dockerfile: Dockerfile
    environment:
      - SERVICE_TYPE=AUTH
      - FIREBASE_SERVICE_ACCOUNT_PATH=/app/serviceAccountKey.json
    env_file:
      - ./BE/.env
    volumes:
      - ./BE:/app
    ports:
      - "8001:8000"

  core-service:
    build:
      context: ./BE
      dockerfile: Dockerfile
    environment:
      - SERVICE_TYPE=CORE
      - FIREBASE_SERVICE_ACCOUNT_PATH=/app/serviceAccountKey.json
    env_file:
      - ./BE/.env
    volumes:
      - ./BE:/app
    ports:
      - "8002:8000"

  ai-service:
    build:
      context: ./BE
      dockerfile: Dockerfile
    environment:
      - SERVICE_TYPE=AI
      - FIREBASE_SERVICE_ACCOUNT_PATH=/app/serviceAccountKey.json
    env_file:
      - ./BE/.env
    volumes:
      - ./BE:/app
    ports:
      - "8003:8000"

  # --- FRONTEND SERVICE ---
  frontend:
    build:
      context: ./edu_grade_ai
      dockerfile: Dockerfile.web
    ports:
      - "8080:80"

  # --- API GATEWAY ---
  gateway:
    image: nginx:alpine
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80"
    depends_on:
      - auth-service
      - core-service
      - ai-service
      - frontend

networks:
  default:
    name: edugrade-network
